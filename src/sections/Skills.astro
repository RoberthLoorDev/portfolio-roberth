---
import { Image } from 'astro:assets'
import { arraySkills } from './../assets/skills/skillsImages'

const colorMap: Record<string, string> = {
     // Frontend
     react: '#61DAFB',
     vue: '#4FC08D',
     angular: '#DD0031',
     astro: '#FF5D01',
     tailwind: '#39BCF9',
     javascript: '#F7DF1E',
     typescript: '#3178C6',
     html: '#E34F26',
     css: '#1572B6',
     'next.js': '#ffffff',
     nextjs: '#ffffff',
     shadcn: '#ffffff',

     // backend
     'node.js': '#84BA64',
     nodejs: '#84BA64',
     nestjs: '#E0234E',
     postgresql: '#326790',
     mongodb: '#47A248',
     mysql: '#4479A1',

     // DevOps y otros
     docker: '#2496ED',
     git: '#F05032',
     github: '#ffffff',
     ubuntu: '#E95420',
}

const getColor = (name: string) => {
     const key = name.toLowerCase().trim()

     if (colorMap[key]) return colorMap[key]

     const keyNoDot = key.replace('.', '')
     if (colorMap[keyNoDot]) return colorMap[keyNoDot]

     return '#64748b'
}
---

<section class="mt-28 mx-4 lg:mx-20" id="skill_section">
     <h3 class="text-3xl font-bold mb-8 text-white">Skills</h3>

     <div class="skills-grid">
          {
               arraySkills.map((imageSkill, index) => {
                    const techColor = getColor(imageSkill.name)

                    return (
                         <div
                              class="skill-card group"
                              style={`
                --tech-color: ${techColor}; 
                --tech-color-dim: ${techColor}33; 
                transition-delay: ${index * 50}ms;
            `}
                         >
                              <div class="glow-bg" />

                              <Image
                                   src={imageSkill.icon}
                                   class="w-auto h-[3rem] lg:h-[3.5rem] object-contain transition-transform duration-300 group-hover:scale-110 z-10 relative grayscale opacity-50 transition-all"
                                   alt={`Logo de ${imageSkill.name}`}
                              />

                              <p class="text-center w-full mt-3 text-sm font-medium text-gray-400 group-hover:text-white transition-colors z-10 relative capitalize">
                                   {imageSkill.name}
                              </p>
                         </div>
                    )
               })
          }
     </div>
</section>

<style>
     .skills-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
          gap: 1.5rem;
          perspective: 1000px;
     }

     .skill-card {
          position: relative;
          background-color: #0e172e;
          border: 1px solid #1f2937;
          border-radius: 0.75rem;
          padding: 2rem 1rem;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          overflow: hidden;
          cursor: pointer;

          opacity: 0;
          transform: translateY(30px) scale(0.9);
          transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
     }

     .skill-card.reveal {
          opacity: 1;
          transform: translateY(0) scale(1);
     }

     /* --- hover neon effect --- */
     .skill-card:hover {
          transform: translateY(-5px) scale(1.02);
          border-color: var(--tech-color);
          box-shadow: 0 10px 30px -10px var(--tech-color-dim);
          transition-delay: 0.2s !important;
     }

     /* Drop shadow to the specific color SVG/PNG */
     .skill-card:hover :global(img) {
          filter: drop-shadow(0 0 8px var(--tech-color));
     }

     .glow-bg {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: radial-gradient(
               circle at center,
               var(--tech-color) 0%,
               transparent 70%
          );
          opacity: 0;
          transition: opacity 0.4s ease;
          z-index: 0;
     }

     .skill-card:hover .glow-bg {
          opacity: 0.15;
     }
</style>

<script>
     const initPageScripts = () => {
          runObserver()
          addHoverEffect()
     }

     // animation on scroll using Intersection Observer
     document.addEventListener('astro:page-load', initPageScripts)
     document.addEventListener('DOMContentLoaded', initPageScripts)

     function runObserver() {
          const observer = new IntersectionObserver(
               (entries) => {
                    entries.forEach((entry) => {
                         if (entry.isIntersecting) {
                              entry.target.classList.add('reveal')
                              observer.unobserve(entry.target) // Stop observing to save resources
                         }
                    })
               },
               { threshold: 0.1 }
          )

          const cards = document.querySelectorAll('.skill-card')
          cards.forEach((card) => observer.observe(card))
     }

     function addHoverEffect() {
          const cards = document.querySelectorAll('.skill-card')
          cards.forEach((card) => {
               card.addEventListener(
                    'mouseenter',
                    () => {
                         const img = card.querySelector('img')
                         if (img) {
                              img.classList.remove('grayscale')
                              img.classList.remove('opacity-50')
                         }
                    },
                    { once: true }
               )
          })
     }
</script>
